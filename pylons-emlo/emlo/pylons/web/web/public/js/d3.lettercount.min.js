!function(p){var w,x,k,t=["creator","recipient","mentioned"],e=["Letters written","Letters received","Letters mentioning"],m=1,y=2,b=3,_="9999",c="?",B={creator:!1,recipient:!1,mentioned:!1,unknown:!1};for(p[p.length-1].year===1*_?(B.unknown=!0,x=(k=p).slice(0,-1)):x=k=p,w=0;w<t.length;w++){var A,n=t[w];for(A=0;A<k.length;A++)if(0!=k[A][n]){B[n]=!0;break}}var H=[],S=[];for(w=0;w<t.length;w++)B[t[w]]&&(H.push(t[w]),S.push(e[w]));var L=!0;for(w=0;w<x.length;w++){for(A=0;A<t.length;A++)if(0!=k[w][t[A]]){L=!1;break}if(!L)break}var R=120,W=25,C=20,F=20,V=35,z=b,r=d3.select("#chart").style("width").replace("px",""),Y=R*H.length+W*(H.length-1),j=r-V-15,q=d3.select("#chart").append("svg").attr("class","chart single").attr("width",r).attr("height",Y);function D(t,e){return d3.max(t,function(t){return e||t.year!=_?z==m?t.creator+t.recipient+t.mentioned:d3.max([t.creator,t.recipient,t.mentioned]):0})}function E(t,e){for(var n=[],r=t.length,a=0;a<r;a++){var i=t[a].year;(e||i!=_)&&(i==_?n.push(c):n.push(i))}return n}function G(t,e){var n,r,a=t,i=[],s=e/a.length,l=10;for(40<s?l=1:20<s?l=3:10<s&&(l=5),r=0;r<a.length;r++)n=a[r],r%l!=0&&n!=c||i.push(n);return i}function I(t,e){var n=3;return t<n?n=t:e!=b&&3*n<=t&&(n*=3),n}function J(t,e){if(e!=b&&t&&2<=t.length){var n=t[1]-t[0]-1;return d3.min([n,4])}return 0}function K(t){return t<H.length?H[t]:""}var M=D(p=L?k:x,L),N=p.length,O=!0,P=[];for(w=0;w<H.length;w++){var a=H[w];if(B[a]){var i=R-F-C,s=V,l=w*(R+W)+F;q.append("text").classed("chart-title",1).classed(a,1).attr("x",s-10).attr("y",l-10).text(S[w]);var Q=d3.scale.linear();Q.domain([0,M]).rangeRound([i,0]);var o=E(p,L),T=d3.scale.ordinal().domain(o).rangeRoundBands([0,j],.2),d=I(M,z),u=Q.ticks(d);q.append("svg:g").classed("guidelines",1).selectAll("line.guideline."+a).data(u,function(t,e){return 0==t?0:e+"-"+a}).enter().append("line").classed("guideline",1).classed(a,1).attr("x1",s).attr("x2",s+j).attr("y1",function(t){return l+Q(t)}).attr("y2",function(t){return l+Q(t)});var f=G(T.domain(),j),h=d3.svg.axis().scale(T).orient("bottom").tickValues(f),g=d3.svg.axis().scale(Q).orient("left").tickFormat(d3.format("f")).ticks(d).tickSize(4,2,0);g.tickSubdivide(J(Q.ticks(d),z)),P[a]={x:h,y:g},q.append("svg:g").classed("xaxis",1).classed("axis",1).classed("label",1).classed(a,1).attr("transform","translate("+s+","+(l+i)+")").call(h),q.append("svg:g").classed("yaxis",1).classed("axis",1).classed("label",1).classed(a,1).attr("transform","translate("+s+","+l+")").call(g)}}function v(n,t){N=(p=L?k:x).length,M=D(p,L);var e=R-F-C,r=V;z!=m&&z!=y||(e=Y-F-C),Q.domain([0,M]).range([e,0]);var a=E(p,L);T.domain(a);var i=G(T.domain(),j),s=I(M,z);for(A=0;A<H.length;A++){var l=H[A],c=P[l].x,o=P[l].y;c.scale(T).tickValues(i),o.scale(Q).ticks(s),o.tickSubdivide(J(Q.ticks(s),z)),q.select(".xaxis."+l).transition().duration(n).call(c),q.select(".yaxis."+l).transition().duration(n).call(o)}var d=Q.ticks(s),u=q.select("g.guidelines").selectAll("line.guideline."+K(0)).data(d,function(t,e){return 0==t?0:e+"-"+K(0)});function f(t,e){e?q.selectAll(t).transition().duration(n/2).delay(3*n/2).style("opacity","1"):q.selectAll(t).transition().duration(3*n/2).style("opacity","0")}if(u.enter().append("line").classed("guideline",1).classed(K(0),1).attr("x1",r).attr("x2",r+j),u.exit().remove(),u.transition().duration(n).attr("y1",function(t){return F+Q(t)}).attr("y2",function(t){return F+Q(t)}),z==m||z==y){for(w=0;w<H.length-1;w++)f(".xaxis."+H[w],!1);for(w=1;w<H.length;w++)f(".yaxis."+H[w],!1),f(".guideline."+H[w],!1),f(".chart-title."+H[w],!1);var h=S[0];3==H.length?h+=", "+S[1]+" and "+S[2]:2==H.length&&(h+=" and "+S[1]),q.select(".chart-title."+K(0)).text(h)}if(z==b){for(w=0;w<H.length-1;w++)f(".xaxis."+H[w],!0);for(w=1;w<H.length;w++)f(".yaxis."+H[w],!0),f(".guideline."+H[w],!0),f(".chart-title."+H[w],!0);0<H.length&&q.select(".chart-title."+K(0)).text(S[0])}for(w=0;w<H.length;w++){l=H[w];if(B[l]){var g=w*(R+W)+F;z!=m&&z!=y||(g=F);var v=q.selectAll("rect."+l).data(p,function(t){return t.year+"-"+l});v.enter().append("rect").classed("bar",1).classed(l,1).attr("x",r+j+2).attr("y",g+e).attr("width",T.rangeBand()).attr("height",0).classed("unknown",function(t){return t.year==_}),v.exit().transition().duration(n).attr("x",r+j+2).remove(),v.append("title").text(function(t){return(t.year!=_?t.year:"Years unknown")+": "+t[l]+" "+S[w]}),O&&v.attr("x",function(t,e){return r+T(e)}),v.transition().duration(n).delay(t).attr("x",function(t,e){var n=0;return z==y&&(l==K(1)?n=T.rangeBand()/H.length:l==K(2)&&(n=2*T.rangeBand()/H.length)),r+T(e)+n}).attr("y",function(t){var e=t[l];if(z==m)if(l==K(0))for(A=1;A<H.length;A++)e+=t[H[A]];else if(l==K(1))for(A=2;A<H.length;A++)e+=t[H[A]];return g+Q(e)}).attr("width",function(){return z==y?T.rangeBand()/H.length:T.rangeBand()}).attr("height",function(t){return e-Q(t[l])})}}O=!1}function U(t,e){for(var n=0;n<t.length;n++)d3.select(t[n]).style("display",e?"none":"inline-block")}function X(t,e){for(var n=0;n<t.length;n++)d3.select(t[n]).classed("highlight",e)}function Z(t){t?(X(["#show_unknown"],!0),d3.select("#show_unknown").text("Hide unknown"),L=!0):(X(["#show_unknown"],!1),d3.select("#show_unknown").text("Show unknown"),L=!1),v(1e3,function(t,e){if(0===t.creator&&0===t.recipient&&0===t.mentioned)return 0;for(var n=0,r=0;n<e;n++)0===p[n].creator&&0===p[n].recipient&&0===p[n].mentioned||(r+=1);return 1200/N*(N-r-1)})}function $(t){z=t,X(["#bars_stacked","#bars_split","#bars_seperate"],!1),X(["#bars_"+t],!0),v(1e3,function(t,e){if(0===t.creator&&0===t.recipient&&0===t.mentioned)return 0;for(var n=0,r=0;n<e;n++)0===p[n].creator&&0===p[n].recipient&&0===p[n].mentioned||(r+=1);return 1300/N*(N-r-1)})}if(0<H.length){d3.select("#hide_unknown").on("click",function(){Z(!1)}),d3.select("#show_unknown").on("click",function(){Z(!L)}),d3.select("#bars_seperate").on("click",function(){$(b)}),d3.select("#bars_stacked").on("click",function(){$(m)}),d3.select("#bars_split").on("click",function(){$(y)});var tt=d3.select(".csstransforms #fullscreen");if(tt){U(["#fullscreen"],!1);var et=!1;tt.on("click",function(){var t=d3.select("#chart");if(et)t.style("-ms-transform",""),t.style("-webkit-transform",""),t.style("transform",""),tt.text("Fullscreen");else{tt.text("Close");var e=.02*window.innerWidth,n=.02*window.innerHeight,r=window.innerWidth-2*e,a=window.innerHeight-2*n,i=t.node().getBoundingClientRect(),s=r/i.width,l=1;(l=a/i.height)*i.width>r&&(l=s);var c=(window.innerWidth-i.width)/2,o=(window.innerHeight-i.height)/2,d="";d+="scale("+l+")",d+=" translate("+(c-i.left)/l+"px,"+(o-i.top)/l+"px)",t.style("-ms-transform",d),t.style("-webkit-transform",d),t.style("transform",d)}X(["#fullscreen"],et=!et)})}X(["#show_unknown"],L),U(["#chart .unknown"],!B.unknown),U(["#chart .bars"],1===H.length),U(["#chart"],!1),v(500,function(t,e){if(0===t.creator&&0===t.recipient&&0===t.mentioned)return 0;for(var n=0,r=0;n<e;n++)0===p[n].creator&&0===p[n].recipient&&0===p[n].mentioned||(r+=1);return 40*r})}}(person_data);